namespace Puzzle5.Part2
{
	internal class Puzzle
	{
		internal List<Edge> Edges = new List<Edge>()
		{
			new Edge(414,379,827,379),
			new Edge(683,947,183,947),
			new Edge(156,577,480,577),
			new Edge(939,503,939,959),
			new Edge(388,907,388,349),
			new Edge(73,572,539,106),
			new Edge(530,157,530,530),
			new Edge(959,896,123,60),
			new Edge(416,698,475,698),
			new Edge(856,281,856,943),
			new Edge(658,767,806,915),
			new Edge(774,799,252,799),
			new Edge(763,833,763,469),
			new Edge(66,314,359,314),
			new Edge(47,984,974,57),
			new Edge(377,52,377,739),
			new Edge(168,935,767,935),
			new Edge(536,778,354,778),
			new Edge(222,919,961,180),
			new Edge(31,419,31,390),
			new Edge(475,232,317,232),
			new Edge(989,980,989,855),
			new Edge(825,237,627,39),
			new Edge(318,896,413,801),
			new Edge(208,57,888,57),
			new Edge(403,796,104,796),
			new Edge(923,937,169,183),
			new Edge(590,827,903,514),
			new Edge(846,416,715,416),
			new Edge(639,221,280,221),
			new Edge(337,554,66,554),
			new Edge(180,121,867,808),
			new Edge(369,402,446,402),
			new Edge(134,857,980,11),
			new Edge(978,957,818,797),
			new Edge(653,75,817,75),
			new Edge(503,391,566,391),
			new Edge(156,392,766,392),
			new Edge(484,231,91,231),
			new Edge(193,302,193,947),
			new Edge(535,145,122,558),
			new Edge(688,629,688,584),
			new Edge(661,85,780,85),
			new Edge(670,765,670,32),
			new Edge(53,892,572,373),
			new Edge(188,893,937,893),
			new Edge(957,127,375,127),
			new Edge(167,309,167,460),
			new Edge(918,611,851,611),
			new Edge(512,286,710,484),
			new Edge(878,434,878,152),
			new Edge(785,546,41,546),
			new Edge(468,278,145,601),
			new Edge(243,181,916,854),
			new Edge(499,734,534,734),
			new Edge(278,72,278,242),
			new Edge(739,672,739,965),
			new Edge(920,147,165,147),
			new Edge(809,232,809,42),
			new Edge(405,349,405,178),
			new Edge(742,228,97,228),
			new Edge(85,543,85,454),
			new Edge(32,181,38,187),
			new Edge(869,693,869,822),
			new Edge(971,444,642,115),
			new Edge(653,950,325,622),
			new Edge(648,174,107,174),
			new Edge(866,310,866,409),
			new Edge(951,145,951,237),
			new Edge(744,447,774,417),
			new Edge(881,570,373,570),
			new Edge(807,217,572,217),
			new Edge(813,554,813,80),
			new Edge(468,651,468,67),
			new Edge(672,989,807,854),
			new Edge(62,644,897,644),
			new Edge(340,263,340,237),
			new Edge(919,513,919,489),
			new Edge(178,272,348,442),
			new Edge(272,419,420,419),
			new Edge(561,188,561,502),
			new Edge(377,169,392,184),
			new Edge(19,240,19,663),
			new Edge(711,756,140,756),
			new Edge(389,404,19,774),
			new Edge(430,222,639,222),
			new Edge(591,676,744,676),
			new Edge(398,79,149,79),
			new Edge(952,658,952,304),
			new Edge(810,431,364,877),
			new Edge(867,133,601,133),
			new Edge(324,830,578,830),
			new Edge(711,817,362,817),
			new Edge(708,681,708,982),
			new Edge(644,282,888,282),
			new Edge(439,204,102,204),
			new Edge(900,34,291,643),
			new Edge(542,603,638,603),
			new Edge(962,933,52,23),
			new Edge(804,936,949,936),
			new Edge(580,542,263,859),
			new Edge(452,267,70,267),
			new Edge(342,877,947,877),
			new Edge(745,197,745,905),
			new Edge(837,135,832,135),
			new Edge(873,260,310,823),
			new Edge(415,51,390,51),
			new Edge(606,703,471,838),
			new Edge(968,753,642,753),
			new Edge(544,434,198,88),
			new Edge(923,21,48,896),
			new Edge(192,927,192,863),
			new Edge(899,88,59,928),
			new Edge(335,854,923,266),
			new Edge(925,375,845,295),
			new Edge(557,799,227,799),
			new Edge(515,863,638,863),
			new Edge(678,235,946,503),
			new Edge(635,582,635,698),
			new Edge(199,577,334,712),
			new Edge(880,503,880,236),
			new Edge(161,191,883,913),
			new Edge(261,211,261,446),
			new Edge(560,374,961,775),
			new Edge(321,278,933,890),
			new Edge(257,472,694,909),
			new Edge(909,828,833,828),
			new Edge(347,966,347,256),
			new Edge(446,326,829,326),
			new Edge(891,927,18,54),
			new Edge(43,392,275,624),
			new Edge(581,760,19,760),
			new Edge(715,308,590,433),
			new Edge(168,11,168,827),
			new Edge(934,29,365,29),
			new Edge(345,39,56,39),
			new Edge(136,924,932,128),
			new Edge(96,381,490,381),
			new Edge(52,794,274,794),
			new Edge(46,90,839,883),
			new Edge(806,156,806,212),
			new Edge(768,155,84,839),
			new Edge(987,189,852,54),
			new Edge(287,73,287,950),
			new Edge(393,579,393,348),
			new Edge(940,528,794,528),
			new Edge(822,66,162,66),
			new Edge(237,515,143,421),
			new Edge(531,396,531,314),
			new Edge(725,429,725,281),
			new Edge(547,217,908,217),
			new Edge(487,253,487,125),
			new Edge(611,662,187,238),
			new Edge(624,10,49,585),
			new Edge(891,186,891,588),
			new Edge(353,453,580,453),
			new Edge(48,283,599,283),
			new Edge(170,287,100,357),
			new Edge(208,825,482,825),
			new Edge(465,844,465,667),
			new Edge(811,587,55,587),
			new Edge(307,675,103,675),
			new Edge(687,707,441,953),
			new Edge(818,832,824,826),
			new Edge(291,855,942,204),
			new Edge(930,543,930,966),
			new Edge(516,285,516,817),
			new Edge(140,120,934,914),
			new Edge(799,835,799,355),
			new Edge(739,267,237,267),
			new Edge(951,937,35,21),
			new Edge(766,58,61,763),
			new Edge(840,573,154,573),
			new Edge(30,952,966,16),
			new Edge(425,152,139,438),
			new Edge(167,889,397,659),
			new Edge(948,646,629,965),
			new Edge(720,431,174,431),
			new Edge(760,758,304,758),
			new Edge(626,155,902,431),
			new Edge(529,459,129,459),
			new Edge(787,722,38,722),
			new Edge(247,951,640,951),
			new Edge(451,441,522,441),
			new Edge(244,509,707,509),
			new Edge(857,475,852,470),
			new Edge(855,126,216,765),
			new Edge(469,366,36,799),
			new Edge(46,348,654,956),
			new Edge(709,726,709,970),
			new Edge(542,684,542,393),
			new Edge(325,904,793,436),
			new Edge(705,53,112,646),
			new Edge(248,146,248,141),
			new Edge(244,912,567,912),
			new Edge(100,198,838,936),
			new Edge(124,929,802,251),
			new Edge(861,667,576,382),
			new Edge(258,369,258,972),
			new Edge(843,128,435,128),
			new Edge(60,174,420,174),
			new Edge(966,972,171,972),
			new Edge(79,737,326,737),
			new Edge(459,959,711,959),
			new Edge(360,936,220,936),
			new Edge(326,861,694,493),
			new Edge(593,108,828,108),
			new Edge(638,921,638,460),
			new Edge(661,363,661,885),
			new Edge(563,321,385,321),
			new Edge(391,662,813,240),
			new Edge(699,324,774,399),
			new Edge(686,268,278,268),
			new Edge(53,105,929,981),
			new Edge(191,853,191,875),
			new Edge(80,431,164,431),
			new Edge(658,847,658,201),
			new Edge(219,139,880,139),
			new Edge(481,14,481,851),
			new Edge(399,812,399,782),
			new Edge(816,335,446,335),
			new Edge(908,466,927,466),
			new Edge(207,752,838,121),
			new Edge(371,86,371,38),
			new Edge(382,975,382,489),
			new Edge(340,885,791,434),
			new Edge(748,230,748,644),
			new Edge(319,418,925,418),
			new Edge(825,146,159,146),
			new Edge(236,818,186,818),
			new Edge(543,715,660,832),
			new Edge(642,634,142,134),
			new Edge(774,229,774,877),
			new Edge(98,752,98,834),
			new Edge(622,840,622,285),
			new Edge(757,853,270,366),
			new Edge(877,741,270,134),
			new Edge(182,839,905,116),
			new Edge(937,278,937,943),
			new Edge(411,433,411,585),
			new Edge(57,492,332,492),
			new Edge(252,215,252,930),
			new Edge(11,149,282,420),
			new Edge(914,491,914,300),
			new Edge(722,623,928,829),
			new Edge(533,194,694,194),
			new Edge(303,251,303,168),
			new Edge(536,382,536,578),
			new Edge(259,92,259,935),
			new Edge(504,875,504,351),
			new Edge(797,923,502,628),
			new Edge(540,343,678,205),
			new Edge(877,874,323,874),
			new Edge(185,787,882,90),
			new Edge(735,582,735,355),
			new Edge(84,104,910,930),
			new Edge(731,14,731,848),
			new Edge(542,364,542,371),
			new Edge(552,141,832,141),
			new Edge(337,371,616,371),
			new Edge(609,328,609,15),
			new Edge(233,112,505,112),
			new Edge(557,248,557,357),
			new Edge(205,507,205,93),
			new Edge(46,27,957,938),
			new Edge(313,214,656,214),
			new Edge(884,893,884,206),
			new Edge(931,508,931,965),
			new Edge(535,667,410,667),
			new Edge(96,661,96,82),
			new Edge(617,952,228,952),
			new Edge(626,249,626,772),
			new Edge(649,400,649,136),
			new Edge(255,829,345,829),
			new Edge(351,210,588,210),
			new Edge(224,456,224,86),
			new Edge(318,393,397,393),
			new Edge(342,620,839,123),
			new Edge(180,81,812,81),
			new Edge(958,988,31,61),
			new Edge(876,127,94,909),
			new Edge(359,710,359,161),
			new Edge(419,437,419,124),
			new Edge(195,881,803,273),
			new Edge(802,56,802,934),
			new Edge(76,60,349,60),
			new Edge(126,862,126,791),
			new Edge(669,106,196,579),
			new Edge(550,191,222,191),
			new Edge(450,680,450,887),
			new Edge(953,55,41,967),
			new Edge(15,21,965,971),
			new Edge(771,829,272,330),
			new Edge(719,481,719,743),
			new Edge(951,875,234,875),
			new Edge(59,94,944,979),
			new Edge(120,175,761,816),
			new Edge(55,413,55,693),
			new Edge(483,426,526,426),
			new Edge(70,971,929,112),
			new Edge(219,53,586,420),
			new Edge(602,827,602,983),
			new Edge(836,641,131,641),
			new Edge(461,206,461,466),
			new Edge(15,614,690,614),
			new Edge(304,717,262,717),
			new Edge(229,603,252,580),
			new Edge(895,237,221,911),
			new Edge(495,308,525,308),
			new Edge(848,273,965,156),
			new Edge(587,11,587,412),
			new Edge(732,307,601,307),
			new Edge(698,726,896,726),
			new Edge(196,763,196,277),
			new Edge(19,43,529,43),
			new Edge(253,97,152,97),
			new Edge(958,98,958,342),
			new Edge(519,339,571,339),
			new Edge(367,83,367,466),
			new Edge(984,130,984,310),
			new Edge(374,806,374,64),
			new Edge(71,247,773,949),
			new Edge(890,602,890,146),
			new Edge(81,163,81,834),
			new Edge(357,683,514,683),
			new Edge(548,733,638,733),
			new Edge(795,887,541,887),
			new Edge(788,219,591,22),
			new Edge(144,788,144,332),
			new Edge(706,519,706,241),
			new Edge(681,281,157,281),
			new Edge(898,967,18,87),
			new Edge(467,84,800,417),
			new Edge(267,25,267,813),
			new Edge(287,282,287,348),
			new Edge(865,453,865,923),
			new Edge(772,779,108,115),
			new Edge(243,194,309,194),
			new Edge(152,716,516,716),
			new Edge(588,504,588,443),
			new Edge(820,298,820,752),
			new Edge(976,320,620,676),
			new Edge(888,453,888,147),
			new Edge(357,538,640,538),
			new Edge(755,118,755,582),
			new Edge(664,480,499,480),
			new Edge(578,265,578,554),
			new Edge(420,874,108,874),
			new Edge(357,604,133,380),
			new Edge(131,83,970,922),
			new Edge(256,50,222,50),
			new Edge(269,750,942,750),
			new Edge(248,594,248,361),
			new Edge(394,322,251,322),
			new Edge(346,383,638,383),
			new Edge(309,450,309,872),
			new Edge(819,882,19,882),
			new Edge(718,254,718,710),
			new Edge(828,31,706,153),
			new Edge(402,374,402,841),
			new Edge(27,362,274,362),
			new Edge(675,933,675,54),
			new Edge(810,634,220,44),
			new Edge(436,205,436,752),
			new Edge(165,41,165,773),
			new Edge(230,297,230,342),
			new Edge(503,275,852,275),
			new Edge(826,79,87,79),
			new Edge(556,411,556,190),
			new Edge(418,131,687,400),
			new Edge(260,493,458,295),
			new Edge(243,282,673,712),
			new Edge(501,78,501,176),
			new Edge(394,72,394,650),
			new Edge(621,636,347,636),
			new Edge(917,139,114,942),
			new Edge(708,873,708,423),
			new Edge(930,681,312,63),
			new Edge(94,209,94,136),
			new Edge(604,104,159,104),
			new Edge(291,740,384,740),
			new Edge(75,670,798,670),
			new Edge(837,620,139,620),
			new Edge(53,504,53,373),
			new Edge(832,660,765,660),
			new Edge(967,11,52,926),
			new Edge(188,885,188,397),
			new Edge(517,567,706,567),
			new Edge(539,177,117,599),
			new Edge(787,702,314,702),
			new Edge(618,863,549,863),
			new Edge(388,322,65,322),
			new Edge(495,19,495,366),
			new Edge(259,256,259,497),
			new Edge(618,358,214,762),
			new Edge(721,355,569,203),
			new Edge(817,184,224,777),
			new Edge(816,573,816,376),
			new Edge(866,181,660,181),
			new Edge(488,704,488,325),
			new Edge(144,233,539,628),
			new Edge(376,920,705,920),
			new Edge(957,478,556,879),
			new Edge(139,470,139,364),
			new Edge(360,174,360,345),
			new Edge(821,168,970,19),
			new Edge(580,972,321,713),
			new Edge(120,111,536,527),
			new Edge(408,555,831,555),
			new Edge(904,808,843,869),
			new Edge(663,114,28,749),
			new Edge(598,61,598,74),
			new Edge(433,907,336,907),
			new Edge(505,649,644,510),
			new Edge(28,30,974,976),
			new Edge(321,848,641,848),
			new Edge(616,68,923,375),
			new Edge(581,816,703,816),
			new Edge(912,473,747,473),
			new Edge(979,868,182,868),
			new Edge(536,339,557,360),
			new Edge(268,732,236,732),
			new Edge(906,964,481,964),
			new Edge(81,529,81,495),
			new Edge(640,820,292,820),
			new Edge(52,79,52,695),
			new Edge(745,610,925,610),
			new Edge(341,30,292,30),
			new Edge(338,629,619,629),
			new Edge(103,591,103,527),
			new Edge(178,211,891,924),
			new Edge(980,79,319,740),
			new Edge(163,164,925,926),
			new Edge(359,275,359,974),
			new Edge(12,987,989,10),
			new Edge(153,394,280,394),
			new Edge(920,741,813,634),
			new Edge(684,806,459,581),
			new Edge(288,670,288,781),
			new Edge(351,819,317,819),
			new Edge(583,920,484,920),
			new Edge(299,427,217,427),
			new Edge(140,295,330,105),
			new Edge(628,566,628,256),
			new Edge(419,701,407,701),
			new Edge(522,789,185,789),
			new Edge(845,683,845,323),
			new Edge(529,47,340,47),
			new Edge(953,982,953,556),
			new Edge(694,811,226,343),
			new Edge(752,251,752,439),
			new Edge(926,177,121,982),
			new Edge(420,263,240,443),
			new Edge(344,423,884,963),
			new Edge(636,674,667,674),
			new Edge(494,891,903,482),
			new Edge(159,900,529,530),
			new Edge(707,589,800,682),
			new Edge(437,317,526,317),
			new Edge(143,95,425,377),
			new Edge(710,191,710,960),
			new Edge(292,595,292,803),
			new Edge(539,689,350,689),
			new Edge(345,473,418,473),
			new Edge(395,79,395,52),
			new Edge(567,603,312,348),
			new Edge(866,790,535,790),
			new Edge(188,849,958,79),
			new Edge(90,283,11,283),
			new Edge(271,795,789,795),
			new Edge(336,729,902,729),
			new Edge(620,638,105,638),
			new Edge(626,523,626,907),
			new Edge(94,218,741,865),
			new Edge(194,169,670,645),
			new Edge(68,37,68,416),
			new Edge(624,771,624,139),
			new Edge(80,920,80,707),
			new Edge(624,829,70,829),
			new Edge(562,499,768,499),
			new Edge(656,821,656,967),
			new Edge(115,516,115,693),
			new Edge(300,871,281,871),
			new Edge(338,491,30,799),
			new Edge(775,54,792,54),
			new Edge(267,111,485,111),
			new Edge(411,981,411,98),
			new Edge(701,416,944,416),
			new Edge(498,885,191,885),
			new Edge(479,283,724,283),
			new Edge(62,695,337,695),
			new Edge(844,557,844,969),
			new Edge(937,980,44,87),
			new Edge(312,99,939,726),
			new Edge(19,988,905,988),
			new Edge(262,185,262,26),
			new Edge(367,369,84,369),
			new Edge(29,161,845,977),
			new Edge(105,30,105,693),
			new Edge(764,830,91,157)
		};

		// Example
		//internal List<Edge> Edges = new List<Edge>()
		//{
		//	new Edge(0,9,5,9),
		//	new Edge(8,0,0,8),
		//	new Edge(9,4,3,4),
		//	new Edge(2,2,2,1),
		//	new Edge(7,0,7,4),
		//	new Edge(6,4,2,0),
		//	new Edge(0,9,2,9),
		//	new Edge(3,4,1,4),
		//	new Edge(0,0,8,8),
		//	new Edge(5,5,8,2)
		//};

		internal int Calculate()
		{
			var coordinates = new Dictionary<Coordinate, int>();
			var overlappingLines = 0;

			foreach (var edge in Edges)
			{
				var xDiff = edge.X2 - edge.X1;
				var xSigning = xDiff > 0 ? 1 : xDiff < 0 ? -1 : 0;

				var yDiff = edge.Y2 - edge.Y1;
				var ySigning = yDiff > 0 ? 1 : yDiff < 0 ? -1 : 0;

				var max = Math.Max(Math.Abs(xDiff), Math.Abs(yDiff)) + 1;
				for (var i = 0; i < max; i++)
				{
					var coordinate = new Coordinate(edge.X1 + i * xSigning, edge.Y1 + i * ySigning);
					coordinates.TryGetValue(coordinate, out var count);
					if(count == 1)
					{
						overlappingLines++;
					}
					coordinates[coordinate] = count + 1;
				}
			}

			return overlappingLines;
		}

		public struct Edge
		{
			public Edge(int x1,
				int y1,
				int x2,
				int y2)
			{
				X1 = x1;
				Y1 = y1;
				X2 = x2;
				Y2 = y2;
			}

			public int X1 { get; }
			public int Y1 { get; }
			public int X2 { get; }
			public int Y2 { get; }
		}

		public struct Coordinate
		{
			public Coordinate(int x, int y)
			{
				X = x;
				Y = y;
			}

			public int X;
			public int Y;
		}
	}
}
